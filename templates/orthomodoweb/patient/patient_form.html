{% extends 'orthomodoweb/base.html' %}
{% block content %}

	<script>
		$(document).ready(function() {
			$('#id_dob').datepicker({ dateFormat: 'yy-mm-dd' });
		});
	</script>

	 
	
	{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
	<div class="formcontainer">
		<div class="form_header">Patient Details: {{ patient.name }}</div>
		<form action="{% url 'orthomodoweb:patient-update' pk=patient.id %}" method="post">
			{% csrf_token %}
			<div class="column form_left_container">
			
				<label for="id_code">CODE: </label>
				<input type="text" name="code" id="id_code" maxlength="200" placeholder = "Code (unique)" value = '{{ patient.code }}'>
				<br /><br />
				<label for="id_name">NAME:</label>
				<input type="text" name="name" id="id_name" maxlength="200" placeholder = "Name" value = "{{ patient.name }}">
				<br /><br />
				<label for="id_reference_no">REFERENCE NUMBER:</label>				 
				<input type="text" name="reference_no" id="id_reference_no" maxlength="200" placeholder = "Reference No" value = '{{ patient.reference_no }}'>
				<br /><br />
				<label for="id_email">EMAIL:</label>
				<input type="text" name="email" id="id_email" maxlength="200" placeholder = "email" value = '{{ patient.email }}'>
				<br /><br />
				<label for="id_phone_no_1">PHONE NO. 1:</label>
				<input type="text" name="phone_no_1" id="id_phone_no_1" maxlength="200" placeholder = "phone no 1" value = '{{ patient.phone_no_1 }}'>
				<br /><br />
				<label for="id_phone_no_2">PHONE NO. 2:</label>
				<input type="text" name="phone_no_2" id="id_phone_no_2" maxlength="200" placeholder = "phone no 2" value = '{{ patient.phone_no_2 }}'>
				<br /><br />
			</div>
			<div class="column form_right_container">
				<label for="id_dob">DATE OF BIRTH:</label>
				<input type="text" name="dob" id="id_dob" maxlength="200" placeholder = "" value = '{{ patient.dob|date:"Y-m-d" }}'>
				<br /><br />
				<label for="id_address">ADDRESS:</label>
				<input type="text" name="address" id="id_address" maxlength="300" placeholder = "address" value = '{{ patient.address }}'>
				<br /><br />
				<label for="id_description">DESCRIPTION/NOTES:</label>				
				<br />
				<textarea  rows="8" cols="82" name="description" id="id_description" placeholder = "description/notes">{{ patient.description }}</textarea>		
				<br /><br />
				<input type="submit" value="SAVE" class="button" />
				<br /><br /><br />
				<a class="button" href="{% url 'orthomodoweb:patient-add-job' patient_id=patient.id %}">Add JOB for this Patient</a>	
			</div>
		 </form>
	</div>
	<div class="datatable">
	<div class = "datatable_header">Patient Jobs</div>
		<table>
		<tr>				
				<th colspan="4" class="header_group_1">Basic Info</th>	
				<th colspan="3" class="thickborderleft header_group_2">Orthotrac</th>
				<th colspan="4" class="thickborderleft header_group_3">3d Printing</th>
				<th colspan="2" class="thickborderleft header_group_4">Model info</th>
				<th colspan="5" class="thickborderleft header_group_5">Collection</th>
				<th colspan="5" class="thickborderleft header_group_6">Flag Status</th>
			</tr>
			<tr>
				<th>ID</th>
				<th>Scan Date</th>
				<th>Patient</th>
				<th>Clinician</th>				
				<th class="thickborderleft">Ref No</th>
				<th>Analysed?</th>
				<th>Notes</th>
				<th class="thickborderleft">Printer</th>
				<th>STL file?</th>
				<th>Printed?</th>
				<th>Print Date</th>
				<th class="thickborderleft">Type</th>
				<th>Notes</th>
				<th class="thickborderleft">Type</th>
				<th>Planned Date</th>
				<th>Time</th>
				<th>Notes</th>
				<th>Collected?</th>
				<th class="thickborderleft">Status</th>
				<th >Notes</th>
			</tr>
		{% if patient.orthomodojob_set %}
		{% for orthomodojob in patient.orthomodojob_set.all  %}
			<tr>
		
			<td><a href="{% url 'orthomodoweb:orthomodojob-update' orthomodojob.id %}">OMJOB_{{ orthomodojob.id }}</a></td>
			<td>{{ orthomodojob.scan_date|date:"Y-m-d" }}</td>
			<td><a href="{% url 'orthomodoweb:patient-update' orthomodojob.patient.id %}">{{ orthomodojob.patient.name }}</a></td>
			<td>{% if orthomodojob.clinician %}<a href="{% url 'orthomodoweb:clinician-update' orthomodojob.clinician.id %}">{{ orthomodojob.clinician.name }}</a>{% endif %}</td> 			
			<td class="thickborderleft">{{ orthomodojob.orthotrac_reference_no }}</td>
			<td>{{ orthomodojob.orthotrac_analysis_done|yesno:"Yes,No" }}</td>
			<td>{{ orthomodojob.orthotrac_analysis_notes }}</td>
			<td class="thickborderleft">{% if orthomodojob.printer %}<a href="{% url 'orthomodoweb:printer-update' orthomodojob.printer.id %}">{{ orthomodojob.printer.name }}</a>{% endif %}</td>
			<td>{{ orthomodojob.is_stl_file_prepared|yesno:"Yes,No" }}</td>
			<td>{{ orthomodojob.is_printed|yesno:"Yes,No" }}</td>
			<td>{{ orthomodojob.print_date|date:"Y-m-d" }}</td>
			<td class="thickborderleft">{% if orthomodojob.orthomodel_type %}<a href="{% url 'orthomodoweb:orthomodeltype-update' orthomodojob.orthomodel_type.id %}">{{ orthomodojob.orthomodel_type.name }}</a>{% endif %}</td>
			<td>{{ orthomodojob.orthomodel_notes }}</td>
			<td class="thickborderleft">{% if orthomodojob.collection_type %}<a href="{% url 'orthomodoweb:collectiontype-update' orthomodojob.collection_type.id %}">{{ orthomodojob.collection_type.name }}</a>{% endif %}</td>
			<td>{{ orthomodojob.planned_collection_date|date:"Y-m-d" }}</td>
			<td>{{ orthomodojob.planned_collection_time }}</td>
			<td>{{ orthomodojob.collection_notes }}</td>			
			<td>{{ orthomodojob.is_collected|yesno:"Yes,No" }}</td>
			<td class="thickborderleft status{% if orthomodojob.flagged %}_flagged{% endif %}">{{ orthomodojob.flagged|yesno:"FLAGGED,normal" }}</td>
			<td class="status{% if orthomodojob.flagged %}_flagged{% endif %}">{{ orthomodojob.flag_status_note }}</td>
			</tr>
		{% endfor %}
		</table>	
		
	{% else %}
		<p class="emptylist">No OrthoModoJobs found for this patient.</p>
	{% endif %}
	</div>
	<div class="bottom_action_links">		 
			<!-- <a class="button" href="{% url 'orthomodoweb:patient-add-job' patient_id=patient.id %}">Add JOB for this Patient</a>		 -->
		
			<!-- <a class="button" href="{% url 'orthomodoweb:patient-add' %}">Add NEW Patient</a> -->
		
		 
			<!-- <a class="button_red" href="{% url 'orthomodoweb:patient-delete' patient.id%}">Delete this Patient</a> -->
		
	</div>
	

{% endblock %}